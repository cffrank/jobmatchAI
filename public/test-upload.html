<!DOCTYPE html>
<html>
<head><title>Test Firebase Storage</title></head>
<body>
<h1>Firebase Storage Upload Test</h1>
<input type="file" id="fileInput" accept="image/*">
<button onclick="testUpload()">Upload</button>
<div id="status"></div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'
import { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js'
import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js'

const firebaseConfig = {
  apiKey: 'AIzaSyAaC_RUJUVgJThUOe4GmAChHhd-Du9CvhU',
  authDomain: 'ai-career-os-139db.firebaseapp.com',
  projectId: 'ai-career-os-139db',
  storageBucket: 'ai-career-os-139db.firebasestorage.app',
  messagingSenderId: '529057497050',
  appId: '1:529057497050:web:69933ebef1c282bacecae3',
}

const app = initializeApp(firebaseConfig)
const storage = getStorage(app)
const auth = getAuth(app)

// Sign in first
signInWithEmailAndPassword(auth, 'test1@jobmatch.ai', 'TestPassword123!')
  .then(() => {
    document.getElementById('status').innerHTML = 'Signed in! Ready to upload.'
  })
  .catch(err => {
    document.getElementById('status').innerHTML = 'Auth error: ' + err.message
  })

window.testUpload = async function() {
  const file = document.getElementById('fileInput').files[0]
  if (!file) {
    alert('Please select a file')
    return
  }

  const userId = auth.currentUser?.uid
  if (!userId) {
    alert('Not authenticated')
    return
  }

  const storagePath = `users/${userId}/profile/avatar.jpg`
  const storageRef = ref(storage, storagePath)
  const uploadTask = uploadBytesResumable(storageRef, file)

  uploadTask.on('state_changed',
    (snapshot) => {
      const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100
      document.getElementById('status').innerHTML = 'Upload progress: ' + progress + '%'
    },
    (error) => {
      document.getElementById('status').innerHTML = 'Error: ' + error.message
      console.error('Upload error:', error)
    },
    async () => {
      const downloadURL = await getDownloadURL(uploadTask.snapshot.ref)
      document.getElementById('status').innerHTML = 'Upload complete! URL: ' + downloadURL
      console.log('Download URL:', downloadURL)
    }
  )
}
</script>
</body>
</html>
