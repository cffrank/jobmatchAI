# =============================================================================
# Railway Deployment Configuration - JobMatch AI Backend (Express.js API)
# =============================================================================
# This file configures how Railway builds and deploys the Express.js backend.
# Documentation: https://docs.railway.app/deploy/config-as-code

[build]
# Builder to use for the deployment
builder = "NIXPACKS"

# Build command - TypeScript compilation
# Install all deps for build, then prune devDependencies for production
# Use --legacy-peer-deps to avoid cache conflicts
buildCommand = "npm ci --legacy-peer-deps && npm run build && npm prune --omit=dev"

# Watch patterns - trigger rebuild on these file changes
watchPatterns = ["src/**/*.ts", "package.json", "tsconfig.json"]

# Disable cache to avoid EBUSY errors with vite/vitest
[build.env]
NIXPACKS_NO_CACHE = "1"

[deploy]
# Command to start the server
startCommand = "npm start"

# Health check endpoint
healthcheckPath = "/health"

# Health check timeout (seconds)
healthcheckTimeout = 300

# Restart policy on crashes
restartPolicyType = "ON_FAILURE"

# Maximum restart attempts
restartPolicyMaxRetries = 10

# Railway automatically injects PORT and NODE_ENV environment variables
# No [env] section needed - let Railway manage environment variables
