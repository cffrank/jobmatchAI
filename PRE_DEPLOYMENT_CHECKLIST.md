# Pre-Deployment Checklist - JobMatch AI

Use this checklist before deploying to production or staging environments. This ensures all critical configuration, testing, and security measures are in place.

---

## Environment Preparation

### Local Development Environment

- [ ] Node.js 20+ installed and verified (`node --version`)
- [ ] Firebase CLI installed and updated (`firebase --version`)
- [ ] Git repository is clean with no uncommitted changes
- [ ] All dependencies installed (`npm ci` in root and `functions/` directories)
- [ ] `.env.local` file exists with all required Firebase config variables
- [ ] `.env.local` is in `.gitignore` (never committed to Git)

### Firebase CLI Authentication

- [ ] Logged into Firebase CLI (`firebase login`)
- [ ] Correct Firebase project selected (`firebase use ai-career-os-139db`)
- [ ] User has Owner or Editor permissions on the project
- [ ] Firebase project is on Blaze (pay-as-you-go) plan

---

## Configuration Verification

### Firebase Console Setup

#### Authentication
- [ ] Email/Password authentication enabled
- [ ] Google OAuth provider enabled and configured
- [ ] Authorized domains include:
  - `localhost` (for development)
  - `ai-career-os-139db.web.app` (Firebase hosting)
  - `ai-career-os-139db.firebaseapp.com` (Firebase hosting)
  - Your custom domain (if applicable)

#### Firestore
- [ ] Firestore database created
- [ ] Default location selected (e.g., `us-central`)
- [ ] Database is in production mode (not test mode)

#### Storage
- [ ] Storage bucket created
- [ ] Default location selected
- [ ] CORS configured if accessing from custom domain

#### Cloud Functions
- [ ] Functions are enabled for the project
- [ ] Billing account is linked
- [ ] Secret Manager API is enabled

### Environment Variables & Secrets

#### Local (.env.local)
- [ ] `VITE_FIREBASE_API_KEY` set
- [ ] `VITE_FIREBASE_AUTH_DOMAIN` set
- [ ] `VITE_FIREBASE_PROJECT_ID` set
- [ ] `VITE_FIREBASE_STORAGE_BUCKET` set
- [ ] `VITE_FIREBASE_MESSAGING_SENDER_ID` set
- [ ] `VITE_FIREBASE_APP_ID` set

#### Firebase Functions Secrets
- [ ] `OPENAI_API_KEY` set (`firebase functions:secrets:set OPENAI_API_KEY`)
- [ ] OpenAI API key verified and has billing enabled
- [ ] Secrets accessible to functions (`firebase functions:secrets:access OPENAI_API_KEY`)

#### GitHub Actions Secrets (for CI/CD)
- [ ] `VITE_FIREBASE_API_KEY` added to repository secrets
- [ ] `VITE_FIREBASE_AUTH_DOMAIN` added
- [ ] `VITE_FIREBASE_PROJECT_ID` added
- [ ] `VITE_FIREBASE_STORAGE_BUCKET` added
- [ ] `VITE_FIREBASE_MESSAGING_SENDER_ID` added
- [ ] `VITE_FIREBASE_APP_ID` added
- [ ] `FIREBASE_SERVICE_ACCOUNT` added (full JSON from service account key)

---

## Code Quality & Testing

### Linting & Type Checking

- [ ] ESLint passes with no errors (`npm run lint`)
- [ ] TypeScript compiles with no errors (`npm run build`)
- [ ] No console.error or console.warn in production code
- [ ] No TODO/FIXME comments in critical paths

### Build Verification

- [ ] Production build completes successfully (`npm run build`)
- [ ] Build output in `dist/` directory is valid
- [ ] No build warnings about missing environment variables
- [ ] Assets are properly optimized (check `dist/` size)
- [ ] Preview build works locally (`npm run preview`)

### Unit Tests (if applicable)

- [ ] All unit tests pass
- [ ] Test coverage meets minimum threshold
- [ ] No skipped tests in critical code paths

### Integration Tests

- [ ] Firebase emulator tests pass (if configured)
- [ ] Authentication flows tested locally
- [ ] Firestore CRUD operations tested
- [ ] Cloud Functions tested in emulator

---

## Security Review

### Firestore Security Rules

- [ ] `firestore.rules` file reviewed
- [ ] All collections have proper authentication checks
- [ ] User data is protected (users can only access their own data)
- [ ] No overly permissive rules (no `allow read, write: if true`)
- [ ] Production-ready rules (no test mode rules)
- [ ] Rules validated locally:
  ```bash
  firebase emulators:start --only firestore
  # Run manual tests against emulator
  ```

#### Critical Rules Verified:
- [ ] Users can only read/write their own profile data
- [ ] Users can only access their own subcollections (workExperience, education, etc.)
- [ ] Jobs collection is read-only for users (write via Functions only)
- [ ] Subscription/billing data is read-only for users (write via Functions/webhooks only)

### Storage Security Rules

- [ ] `storage.rules` file reviewed
- [ ] File type validation enforced (images, PDFs, DOCX only)
- [ ] File size limits enforced:
  - Profile photos: 2MB max
  - Resumes/documents: 5MB max
  - Exports: 10MB max
- [ ] User can only access their own files
- [ ] Invoices are read-only (generated by Functions only)

### Cloud Functions Security

- [ ] Functions require authentication (`request.auth != null`)
- [ ] Input validation implemented for all function parameters
- [ ] Secrets are not hardcoded (using Secret Manager)
- [ ] Functions have appropriate timeout settings (not too high)
- [ ] Functions have memory limits configured
- [ ] Error messages don't leak sensitive information

### Environment & Secrets

- [ ] No secrets committed to Git repository
- [ ] `.env.local` is in `.gitignore`
- [ ] Service account keys are not committed
- [ ] API keys have appropriate restrictions (domain/IP whitelist if possible)
- [ ] OpenAI API key has usage limits configured

---

## Firestore Configuration

### Indexes

- [ ] `firestore.indexes.json` includes all required composite indexes
- [ ] Checked for missing indexes in development (Firebase Console warnings)
- [ ] Common queries tested and work without full collection scans

#### Required Indexes Verified:
- [ ] `trackedApplications`: `archived` (ASC) + `lastUpdated` (DESC)
- [ ] Additional indexes for complex queries with `where()` + `orderBy()`

### Data Model

- [ ] Collections and subcollections match application structure
- [ ] Field names are consistent across collections
- [ ] Timestamps use `serverTimestamp()` for consistency
- [ ] Document IDs are auto-generated (not user-controlled)

---

## Cloud Functions Configuration

### Function Dependencies

- [ ] `functions/package.json` has all required dependencies
- [ ] Dependencies are up-to-date (no critical vulnerabilities)
  ```bash
  cd functions
  npm audit
  ```
- [ ] `firebase-admin` and `firebase-functions` versions are compatible
- [ ] OpenAI SDK version is compatible with API

### Function Code Review

- [ ] `generateApplication` function tested with real API key
- [ ] Fallback logic works when OpenAI API fails
- [ ] Error handling is robust
- [ ] Logging is appropriate (no sensitive data in logs)
- [ ] Functions follow Firebase best practices:
  - Always return a promise
  - Handle errors properly
  - Set appropriate timeouts

### Function Configuration

- [ ] Timeout set appropriately (e.g., 120s for AI generation)
- [ ] Memory allocation is sufficient (512MiB for AI calls)
- [ ] Region is appropriate (us-central1 is default)
- [ ] Secrets are properly referenced in function config

---

## GitHub Actions Workflow

### Workflow Configuration

- [ ] `.github/workflows/firebase-deploy.yml` exists
- [ ] Workflow triggers on push to `main` branch
- [ ] Pull requests trigger preview deployments
- [ ] Build step uses correct Node.js version (20)
- [ ] Environment variables are passed correctly to build

### Workflow Testing

- [ ] Workflow has been tested on a feature branch
- [ ] Preview deployments work correctly
- [ ] Build artifacts are uploaded correctly
- [ ] Deployment to Firebase succeeds
- [ ] Workflow notifications work (if configured)

---

## Performance & Optimization

### Frontend Optimization

- [ ] Build size is reasonable (check `dist/` size)
- [ ] Large dependencies are code-split
- [ ] Images are optimized
- [ ] Lazy loading implemented for routes
- [ ] Firestore listeners are cleaned up on unmount

### Backend Optimization

- [ ] Firestore queries use indexes (no full collection scans)
- [ ] Functions have appropriate memory limits
- [ ] Cold start time is acceptable (< 5 seconds)
- [ ] Database reads are minimized (batching where possible)

---

## Monitoring & Alerting

### Logging

- [ ] Application logging is configured
- [ ] Function logging includes important events
- [ ] Error logging captures stack traces
- [ ] No sensitive data in logs (PII, API keys, passwords)

### Alerts (Configure after first deployment)

- [ ] Budget alerts configured in Firebase Console
- [ ] Function error rate alerts set up
- [ ] High latency alerts configured
- [ ] Authentication failure alerts configured

---

## Documentation

### User-Facing

- [ ] Privacy policy created (if handling user data)
- [ ] Terms of service created (if applicable)
- [ ] Help/FAQ section prepared
- [ ] Contact/support information available

### Developer Documentation

- [ ] README.md is up-to-date
- [ ] DEPLOYMENT.md is accurate
- [ ] Environment setup instructions are clear
- [ ] Architecture documentation exists
- [ ] API documentation for Cloud Functions (if public)

---

## Backup & Recovery

### Data Backup

- [ ] Backup strategy defined
- [ ] Firestore export tested:
  ```bash
  gcloud firestore export gs://ai-career-os-139db.appspot.com/backups/test
  ```
- [ ] Backup storage bucket has lifecycle rules
- [ ] Recovery procedure documented

### Rollback Plan

- [ ] Rollback procedure documented
- [ ] Previous deployment is tagged in Git
- [ ] Rollback commands are ready (see DEPLOYMENT.md)
- [ ] Team knows how to execute rollback

---

## Final Verification

### Pre-Deployment Commands

Run these commands before deploying:

```bash
# Verify Firebase project
firebase use

# Validate Firestore rules
firebase deploy --only firestore --dry-run

# Validate Storage rules
firebase deploy --only storage --dry-run

# Check function configuration
cd functions && npm ls && cd ..

# Run linter
npm run lint

# Build production bundle
npm run build

# Check build size
du -sh dist/
```

### Deployment Dry Run

- [ ] Dry run of Firestore deployment succeeds
- [ ] Dry run of Storage deployment succeeds
- [ ] Functions can be deployed to emulator
- [ ] Build completes without warnings
- [ ] All environment variables are available

---

## Post-Deployment Verification

After deployment, verify these items (see DEPLOYMENT.md for details):

- [ ] Run `verify-deployment.sh` script
- [ ] Test authentication (email/password and Google OAuth)
- [ ] Test Firestore CRUD operations
- [ ] Test Storage file upload
- [ ] Test Cloud Functions (generateApplication)
- [ ] Check Firebase Console for errors
- [ ] Monitor function logs for first 30 minutes
- [ ] Verify no unexpected costs in billing dashboard

---

## Team Communication

### Pre-Deployment Notification

- [ ] Team notified of upcoming deployment
- [ ] Deployment window communicated
- [ ] Expected downtime communicated (if any)
- [ ] Rollback plan shared with team

### Post-Deployment Notification

- [ ] Team notified of successful deployment
- [ ] Deployment URL shared
- [ ] Known issues communicated
- [ ] Monitoring dashboard links shared

---

## Sign-Off

**Deployment Date:** _________________

**Deployed By:** _________________

**Deployment Type:** [ ] Production [ ] Staging [ ] Development

**Git Commit SHA:** _________________

**All checklist items verified:** [ ] Yes [ ] No

**Notes:**
_________________________________________________________________
_________________________________________________________________
_________________________________________________________________

---

**Last Updated:** December 19, 2025
